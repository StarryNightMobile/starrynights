<!-- Payment Section -->
<div id="payment-form" style="max-width:400px;margin:20px auto;padding:20px;border:1px solid #ddd;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.1);">
  <h3 style="text-align:center;margin-bottom:15px;">Pay with EcoCash</h3>
  <input type="text" id="phone" placeholder="Phone e.g. 0771234567" style="width:100%;padding:10px;margin-bottom:10px;border-radius:5px;border:1px solid #ccc;" />
  <input type="number" id="amount" placeholder="Amount (USD)" style="width:100%;padding:10px;margin-bottom:10px;border-radius:5px;border:1px solid #ccc;" />
  <input type="email" id="email" placeholder="Email" style="width:100%;padding:10px;margin-bottom:15px;border-radius:5px;border:1px solid #ccc;" />
  <button onclick="payNow()" style="width:100%;padding:12px;background:#4CAF50;color:white;border:none;border-radius:5px;font-size:16px;cursor:pointer;">Pay Now</button>
  <p id="payment-message" style="text-align:center;margin-top:10px;color:red;"></p>
</div>

<script>
function payNow() {
  const phoneInput = document.getElementById("phone").value.trim();
  const amount = document.getElementById("amount").value.trim();
  const email = document.getElementById("email").value.trim();
  const messageEl = document.getElementById("payment-message");

  messageEl.textContent = ""; // reset previous message

  if (!phoneInput || !amount || !email) {
    messageEl.textContent = "Please fill in all fields";
    return;
  }

  // Auto-format Zimbabwe phone for EcoCash
  let formattedPhone = phoneInput.replace(/\D/g,''); // remove non-numbers
  if (formattedPhone.startsWith("0")) formattedPhone = "263" + formattedPhone.slice(1);
  else if (formattedPhone.startsWith("7")) formattedPhone = "263" + formattedPhone;
  else if (formattedPhone.startsWith("+")) formattedPhone = formattedPhone.replace("+","");

  fetch("/.netlify/functions/paynow", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      phone: formattedPhone,
      amount,
      email
    })
  })
  .then(res => res.json())
  .then(data => {
    if (data.ok) {
      window.location.href = data.browserurl; // redirect to EcoCash
    } else {
      messageEl.textContent = "Payment failed: " + data.error;
    }
  })
  .catch(err => {
    messageEl.textContent = "Error: " + err.message;
  });
}
</script>